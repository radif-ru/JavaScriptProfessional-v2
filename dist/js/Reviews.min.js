class Reviews{constructor(e,t="#reviews"){this.source=e,this.container=t,this.reviewsItems=[],this._init()}_render(){let e=$("<div/>",{class:"wrapper-author"}),t=$("<p/>",{text:"Name:"}),r=$("<input/>",{class:"author-name"}),s=$("<p/>",{text:"Feedback:"}),a=$("<textarea/>",{class:"author-text",cols:"30",rows:"10",id:"#"}),i=$("<button/>",{class:"author-review-button",text:"Send feedback"}),o=$("<div/>",{class:"json-reviews"}),p=$("<button/>",{class:"send-feedback",text:"Feedback"});t.appendTo(e),r.appendTo(e),s.appendTo(e),a.appendTo(e),i.appendTo(e),$(this.container).append(e),$(this.container).append(o),$(o).append(p),$(e).hide(),p.click(t=>{$(e).show().dialog({modal:!0,title:"You feedback"})})}_init(){if(this._render(),localStorage.getItem("reviews")){this.reviewsItems=JSON.parse(localStorage.getItem("reviews"));for(let e of this.reviewsItems)this._displayReviews(e)}else fetch(this.source).then(e=>e.json()).then(e=>{for(let t of e)this.reviewsItems.push(t),localStorage.setItem("reviews",JSON.stringify(this.reviewsItems)),this._displayReviews(t)});this._toSendReview()}_displayReviews(e){let t=$("<div/>",{class:"review-container",id:e.id,"data-is-approved":e.isApproved});t.append($(`<h3 class="review-author">${e.author}</h3>`)),t.append($(`<p class="review-text">${e.text}</p>`));let r=$('<button class="approve-button">Approve</button>'),s=$('<button class="remove-button">Remove feedback</button>');r.appendTo(t),s.appendTo(t),t.appendTo(".json-reviews"),this._toApprove(r),this._toRemove(s)}_toSendReview(){$(".wrapper-author").keyup(e=>{$(".wrapper-error").remove()}),$(".wrapper-author").on("click",".author-review-button",e=>{if($(".wrapper-error").remove(),$(".author-name").val().length>2&&$(".author-text").val().length>15){$(".wrapper-error").remove();let e=0;this.reviewsItems.forEach(t=>{e<=t.id&&(e=t.id,e++)});let t={author:$(".author-name").val(),id:e,isApproved:!1,text:$(".author-text").val()};this.reviewsItems.push(t),localStorage.setItem("reviews",JSON.stringify(this.reviewsItems)),this._displayReviews(t),$(".author-name").val(""),$(".author-text").val(""),$(".wrapper-author").append($('<p class="wrapper-error">Отзыв успешно добавлен!</p>')),$(".wrapper-error").css("color","green")}else $(".wrapper-author").append($('<p class="wrapper-error">Имя должно быть не менее 3 символов, а отзыв не менее 15!</p>'))})}_toApprove(e){e.click(e=>{e.target.parentElement.dataset.isApproved="true";for(let t of this.reviewsItems)+e.target.parentElement.id==+t.id&&(t.isApproved="true")})}_toRemove(e){e.click(e=>{e.target.parentElement.remove();for(let t of this.reviewsItems)+e.target.parentElement.id==+t.id&&this.reviewsItems.splice(this.reviewsItems.indexOf(t),1);localStorage.setItem("reviews",JSON.stringify(this.reviewsItems))})}}